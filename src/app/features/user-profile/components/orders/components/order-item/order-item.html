<div class="order-card mb-8 border-b border-gray-300 pb-8">
  <div class="flex items-start justify-between mb-1">
    <div>
      <h4 class="text-lg font-bold text-gray-900">Order #{{ order.id }}</h4>
      <p class="text-sm text-gray-500">
        {{ order.createdAt | date: 'd-MMM-yyyy, h:mm a' }}
      </p>
      <p
        class="text-sm font-medium mt-1"
        [class.text-green-600]="isDelivered"
        [class.text-red-600]="isCancelled"
        [class.text-orange-500]="!isDelivered && !isCancelled"
      >
        {{ statusLabel }}
      </p>
    </div>
    @if (canCancel) {
      <button
        (click)="onCancel()"
        class="px-2 py-1 md:px-4 md:py-2 text-sm font-medium text-red-600 border border-red-600 rounded-lg hover:bg-red-50 transition-colors cursor-pointer"
      >
        Cancel Order
      </button>
    }
  </div>

  <div class="flex flex-col lg:flex-row gap-8 mt-6">
    <div class="flex-1 overflow-x-auto">
      <div class="timeline flex items-start justify-between relative">
        <div class="absolute top-5.5 left-5.5 right-5.5 h-0.75 bg-gray-200 z-0"></div>
        @if (!isCancelled) {
          <div
            class="absolute top-5.5 left-5.5 h-0.75 z-1 transition-all duration-700 ease-in-out"
            [ngClass]="isDelivered ? 'bg-green-500' : 'bg-[#F87A32]'"
            [style.width]="getProgressWidth()"
          ></div>
        }

        @for (step of getTimelineSteps(); track step.key; let i = $index) {
          <div class="timeline-step flex flex-col items-center z-10 flex-1 relative">
            <div
              class="step-circle w-11.5 h-11.5 rounded-full flex items-center justify-center transition-all duration-500 shadow-sm"
              [ngClass]="{
                'bg-[#F87A32] text-profile-secondary shadow-orange-200':
                  (step.completed || step.active) && !isDelivered && !step.cancelled,
                'bg-green-500 text-profile-secondary shadow-green-200':
                  (step.completed || step.active) && isDelivered,
                'bg-profile-secondary border-[2.5px] border-gray-200 text-gray-300':
                  !step.completed && !step.active && !step.cancelled,
                'bg-red-500 text-profile-secondary shadow-red-200 cancelled-pulse': step.cancelled,
              }"
            >
              @if (step.icon === 'placed') {
                <svg
                  class="w-7 h-7"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="2" x2="12" y2="22" />
                  <line x1="2" y1="12" x2="22" y2="12" />
                  <line x1="4.93" y1="4.93" x2="19.07" y2="19.07" />
                  <line x1="19.07" y1="4.93" x2="4.93" y2="19.07" />
                </svg>
              }
              @if (step.icon === 'confirmed') {
                <svg
                  class="w-7 h-7"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                  />
                  <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
                  <path d="M9 14l2 2 4-4" />
                </svg>
              }
              @if (step.icon === 'processed') {
                <svg
                  class="w-7 h-7"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10" />
                  <path d="M9 12l2 2 4-4" />
                </svg>
              }
              @if (step.icon === 'ready') {
                <svg
                  class="w-7 h-7"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M16.5 9.4l-9-5.19" />
                  <path
                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                  />
                  <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                  <line x1="12" y1="22.08" x2="12" y2="12" />
                </svg>
              }
              @if (step.icon === 'delivery') {
                <svg
                  class="w-7 h-7"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="1" y="3" width="15" height="13" rx="2" />
                  <path d="M16 8h4l3 5v5h-7V8z" />
                  <circle cx="5.5" cy="18.5" r="2.5" />
                  <circle cx="18.5" cy="18.5" r="2.5" />
                </svg>
              }
              @if (step.icon === 'cancelled') {
                <svg
                  class="w-7 h-7"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="white"
                  stroke-width="2.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10" />
                  <line x1="4.93" y1="4.93" x2="19.07" y2="19.07" />
                </svg>
              }
            </div>
            <span
              class="text-[11px] mt-2 text-center font-semibold leading-tight max-w-20"
              [ngClass]="{
                'text-[#F87A32]':
                  (step.completed || step.active) && !isDelivered && !step.cancelled,
                'text-green-600': (step.completed || step.active) && isDelivered,
                'text-gray-300': !step.completed && !step.active && !step.cancelled,
                'text-red-500 font-bold': step.cancelled,
              }"
            >
              {{ step.label }}
            </span>
          </div>
        }
      </div>
    </div>

    <div class="flex-1">
      <div class="flex flex-wrap gap-4 mb-4">
        @for (item of order.items; track item.productId) {
          <div class="flex flex-col items-center w-35">
            <div class="w-25 h-25 bg-gray-50 rounded-lg p-2 flex items-center justify-center">
              <img
                [src]="item.productImage"
                [alt]="item.productName"
                class="max-w-full max-h-full object-contain"
              />
            </div>
            <p class="text-xs text-gray-700 text-center mt-2 font-medium leading-tight">
              {{ item.productName }} x {{ item.quantity }}
            </p>
            <p class="text-xs text-gray-500 text-center">
              {{ item.total | currency: 'USD' }}
            </p>
          </div>
        }
      </div>
      <div class="flex items-center justify-between border-t border-gray-200 pt-3">
        <span class="text-sm font-semibold text-gray-700">TOTAL</span>
        <span class="text-lg font-bold text-gray-900">
          {{ order.total | currency: 'USD' }}
        </span>
      </div>
    </div>
  </div>
</div>
